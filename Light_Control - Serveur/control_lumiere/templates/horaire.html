{% extends 'base_admin.html' %}

{% block contenu %}
    <div class="container mt-5">

        <!-- En-tête bleu -->
        <div class="bg-primary text-white p-3 mb-4">
            <h2 class="m-0">Programmer Horaires d'Éclairage</h2>
        </div>

        <!-- Card pour le formulaire -->
        <div class="card">
            <div class="card-body">
                <!-- Titre du formulaire -->
                <a href="#" class="text-decoration-none text-primary d-flex align-items-center">
                    <i class="bi bi-lightbulb-fill me-2"></i> Programmer les Horaires
                </a>

                <!-- Formulaire -->
                <form id="horaires-form" class="mt-4 needs-validation" novalidate>
                    <!-- Heure d'allumage -->
                    <div class="mb-3">
                        <label for="heureAllumage" class="form-label">Heure d'allumage :</label>
                        <input type="time" class="form-control" id="heureAllumage" name="heureAllumage" required>
                        <div class="invalid-feedback">
                            Veuillez entrer une heure d'allumage valide.
                        </div>
                    </div>

                    <!-- Heure d'éteignage -->
                    <div class="mb-3">
                        <label for="heureEteignage" class="form-label">Heure d'éteignage :</label>
                        <input type="time" class="form-control" id="heureEteignage" name="heureEteignage" required>
                        <div class="invalid-feedback">
                            Veuillez entrer une heure d'éteignage valide.
                        </div>
                    </div>

                    <!-- Jours de la semaine -->
                    <div class="mb-3">
                        <label class="form-label">Jours d'activation :</label>
                        <div class="d-flex flex-wrap gap-2" id="jours-checkboxes">
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="lundi" value="Lundi" name="jours[]">
                                <label class="form-check-label" for="lundi">Lundi</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="mardi" value="Mardi" name="jours[]">
                                <label class="form-check-label" for="mardi">Mardi</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="mercredi" value="Mercredi" name="jours[]">
                                <label class="form-check-label" for="mercredi">Mercredi</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="jeudi" value="Jeudi" name="jours[]">
                                <label class="form-check-label" for="jeudi">Jeudi</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="vendredi" value="Vendredi" name="jours[]">
                                <label class="form-check-label" for="vendredi">Vendredi</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="samedi" value="Samedi" name="jours[]">
                                <label class="form-check-label" for="samedi">Samedi</label>
                            </div>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="checkbox" id="dimanche" value="Dimanche" name="jours[]">
                                <label class="form-check-label" for="dimanche">Dimanche</label>
                            </div>
                        </div>
                        <div class="invalid-feedback">
                            Veuillez sélectionner au moins un jour.
                        </div>
                    </div>

                    <!-- Bouton de soumission -->
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-save"></i> Enregistrer les horaires
                    </button>
                </form>

                <!-- Message de confirmation -->
                <div id="confirmation-message" class="alert alert-success mt-3 d-none">
                    Les horaires ont été programmés avec succès !
                </div>

                <!-- Liste des programmations -->
                <div class="mt-4">
                    <h5 class="mb-3">Horaires Programmés</h5>
                    <ul class="list-group" id="liste-programmations">
                        <!-- Les programmations seront ajoutées ici dynamiquement -->
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Inclusion de Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap @5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Script de validation et affichage -->
    <script>
        document.getElementById('horaires-form').addEventListener('submit', function(event) {
            event.preventDefault();

            const heureAllumage = document.getElementById('heureAllumage').value;
            const heureEteignage = document.getElementById('heureEteignage').value;
            const joursSelectionnes = document.querySelectorAll('input[name="jours[]"]:checked');

            let isValid = true;

            if (!heureAllumage || !heureEteignage) {
                isValid = false;
            }

            if (heureAllumage >= heureEteignage) {
                alert("L'heure d'éteignage doit être après l'heure d'allumage.");
                isValid = false;
            }

            if (joursSelectionnes.length === 0) {
                alert("Veuillez sélectionner au moins un jour.");
                isValid = false;
            }

            if (isValid) {
                // Afficher le message de confirmation
                document.getElementById('confirmation-message').classList.remove('d-none');
                document.getElementById('confirmation-message').classList.add('d-block');

                // Récupérer la liste des jours sélectionnés
                const jours = Array.from(joursSelectionnes).map(cb => cb.value);

                // Ajouter chaque jour comme une entrée séparée
                jours.forEach(jour => {
                    const ul = document.getElementById('liste-programmations');

                    // Créer l'élément de liste
                    const li = document.createElement('li');
                    li.className = 'list-group-item d-flex justify-content-between align-items-center';

                    li.innerHTML = `
                        <span><strong>${jour}</strong> : ${heureAllumage} - ${heureEteignage}</span>
                        <button class="btn btn-sm btn-outline-danger">Supprimer</button>
                    `;

                    // Ajouter événement sur "Supprimer"
                    li.querySelector('button').addEventListener('click', () => {
                        ul.removeChild(li);
                    });

                    ul.appendChild(li);
                });

                // Réinitialiser le formulaire
                this.reset();
            }
        });
    </script>
{% endblock %}